---
title: "carbon data analysis"
author: "Rachel Bash"
date: "4/5/2019"
output: pdf_document
geometry: margin=2.54cm
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Carbon Data Wrangling and Analysis


```{r}
getwd()

#load all required packages
library(tidyverse)
library(dplyr)
library(lubridate)
library(FSA)
library(corrplot)
library(viridis)
library(trend)

# Set ggplot theme

Rachel_theme <- theme_bw(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "right")
theme_set(Rachel_theme)
```

```{r}
#import data
carbon.data.processed <- read.csv("./processed-data/NTL-LTER_Carbon_Data_Processed.csv")

#View data
#View(carbon.data)

#set date
carbon.data.processed$sampledate <- as.Date(carbon.data.processed$sampledate, format = "%m/%d/%y")
class(carbon.data.processed$sampledate)
head(carbon.data.processed$sampledate)

```

##Lake absorbance differences
```{r}
#test to see whether there is a significant difference in absorbance values across lakes

#first, test for normality
shapiro.test(carbon.data.processed$absorbance[carbon.data.processed$lakename == "Tuesday Lake"])
shapiro.test(carbon.data.processed$absorbance[carbon.data.processed$lakename == "Paul Lake"])
shapiro.test(carbon.data.processed$absorbance[carbon.data.processed$lakename == "Peter Lake"])
shapiro.test(carbon.data.processed$absorbance[carbon.data.processed$lakename == "East Long Lake"])
shapiro.test(carbon.data.processed$absorbance[carbon.data.processed$lakename == "West Long Lake"])
#result: all have significant p-values, meaning they are not normally distributed data (as anticipated)

#bartlett test to determine whether there is equal variance between groups
bartlett.test(carbon.data.processed$absorbance ~ carbon.data.processed$lakename) 
#result: not equal variances, not great

#used non-parametric test to determine whether lakes vary significantly in their absorbance values
kruskal.test(carbon.data.processed$absorbance ~ carbon.data.processed$lakename)#lakename is a significant predictor of absorbance

#post-hoc non-parametric test
dunnTest(carbon.data.processed$absorbance ~ carbon.data.processed$lakename) #shows all lakes differ from one another significantly 


```

```{r}
#visualize data
ggplot(carbon.data.processed, aes(x=lakename, y = absorbance)) +
  geom_violin(draw_quantiles = 0.5)
```

#Correlation between continuous variables
```{r}
#correlation plot
carbon.data.processed.naomit <- carbon.data.processed %>% 
  select(DIC_uM:absorbance) %>%
  na.omit()

carbonCorr <- cor(carbon.data.processed.naomit)
corrplot.mixed(carbonCorr, upper = "ellipse")
```


##Linear regression model
```{r}
#Step-wise linear regression
#did not include DIC because it just had too many NAs and wouldn't work to run the model
steplm <- lm(data=carbon.data.processed, absorbance ~ depth + doc  + lakename)
step(steplm) #taking out none would result in the lowest AIC value, therefore all variables help predict and best explain absorbance

#full-model is the best, as shown by the step 
fullmodel <- lm(data=carbon.data.processed, absorbance ~ depth + doc  + lakename)
summary(fullmodel)
```

```{r}
#graph the result
ggplot(carbon.data.processed, aes(x=lakename, y=absorbance)) +
         geom_point(aes(color=doc), alpha = 0.5) +
         facet_wrap(vars(depth)) +
         theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
         scale_color_viridis(option="viridis", direction = -1)
```

##Time Series Analysis
```{r}
summary(carbon.data.processed$absorbance)
```

